<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quandary Admin - Room Management</title>
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="/admin.css">
    <link rel="stylesheet" href="/theme-gallery.css">
    <script src="/theme-manager.js"></script>
    <script src="/layout-validator.js"></script>
    <script src="/theme-gallery.js"></script>
</head>
<body>
    <nav class="navigation">
        <button class="nav-btn" onclick="window.location.href='/index.html'">‚Üê Player View</button>
    </nav>

    <header class="admin-header">
        <h1>üèóÔ∏è Quandary Admin Dashboard</h1>
        <p>Room Creation & Management Center</p>
    </header>

    <div class="admin-container">
        <div class="actions-header">
            <button class="btn-primary" id="create-room-btn">Create New Room</button>
        </div>

        <div id="room-grid" class="room-grid">
            <!-- Rooms will be loaded here -->
        </div>
        
        <div class="tv-portal-section">
            <button class="btn-tv-portal" id="tv-portal-btn" onclick="window.open('/tv', '_blank')">
                üì∫ Open TV Friendly Portal
            </button>
            <p class="tv-portal-description">
                Access the Android TV optimized interface for remote control navigation
            </p>
        </div>
    </div>

    <!-- Create/Edit Room Modal -->
    <div id="room-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Create New Room</h2>
                <button class="close-btn" id="close-modal">√ó</button>
            </div>
            <form id="room-form">
                <div class="form-group">
                    <label for="room-name">Room Name</label>
                    <input type="text" id="room-name" class="form-input" required aria-describedby="room-name-help" aria-required="true">
                    <div id="room-name-help" class="sr-only">Enter a unique name for your room (2-100 characters)</div>
                </div>
                <div class="form-group">
                    <label for="timer-duration">Timer Duration (MM:SS)</label>
                    <input type="text" id="timer-duration" class="form-input" placeholder="00:00" pattern="[0-9]{1,2}:[0-9]{2}" aria-describedby="timer-duration-help" aria-label="Set timer duration in minutes and seconds">
                    <div id="timer-duration-help" class="sr-only">Set room timer duration in MM:SS format (00:00 for no timer)</div>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="secondary-timer-enabled">
                        <span>Enable Secondary Timer</span>
                    </label>
                    <div id="secondary-timer-duration-group" style="display: none; margin-top: 0.5rem;">
                        <label for="secondary-timer-duration">Secondary Timer Duration (MM:SS)</label>
                        <input type="text" id="secondary-timer-duration" class="form-input" placeholder="00:00" pattern="[0-9]{1,2}:[0-9]{2}" aria-describedby="secondary-timer-duration-help" aria-label="Set secondary timer duration in minutes and seconds">
                        <div id="secondary-timer-duration-help" class="sr-only">Set secondary timer duration in MM:SS format (00:00 for no timer)</div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="hint-type">Hint System</label>
                    <select id="hint-type" class="form-input" aria-describedby="hint-type-help">
                        <option value="broadcast">One-way Broadcast</option>
                        <option value="chat">Two-way Chat</option>
                    </select>
                    <div id="hint-type-help" class="sr-only">Choose how hints are delivered to players</div>
                </div>
                <div class="form-group">
                    <label for="api-variables">API Variables (JSON)</label>
                    <div class="variable-controls">
                        <textarea id="api-variables" class="form-input" rows="4" placeholder='{}' readonly aria-describedby="api-variables-help" aria-label="API Variables in JSON format"></textarea>
                        <button type="button" class="btn-manage-variables btn-secondary" id="manage-variables-btn" aria-label="Open variable management dialog">
                            ‚úèÔ∏è Manage Variables
                        </button>
                        <div id="api-variables-help" class="sr-only">Configure custom variables for API integration in JSON format</div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="room-theme">Theme</label>
                    <select id="room-theme" class="form-input" aria-describedby="room-theme-help">
                        <option value="example-theme">Example Theme</option>
                        <!-- Themes will be loaded dynamically -->
                    </select>
                    <div id="room-theme-help" class="sr-only">Select the theme for this room's player interface</div>
                </div>
                <div class="form-group">
                    <label for="config">Configuration (JSON)</label>
                    <div class="action-controls">
                        <textarea id="config" class="form-input" rows="4" placeholder='{}' readonly aria-describedby="config-help" aria-label="Room configuration in JSON format"></textarea>
                        <button type="button" class="btn-manage-actions btn-secondary" id="manage-actions-btn" aria-label="Open action configuration dialog">
                            ‚ö° Manage Actions
                        </button>
                        <div id="config-help" class="sr-only">Set room behavior and actions in JSON configuration format</div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" id="cancel-btn" aria-describedby="cancel-help">Cancel</button>
                    <button type="submit" class="btn-primary" id="save-btn" aria-describedby="save-help" aria-live="polite">Save Room</button>
                    <div id="cancel-help" class="sr-only">Close without saving changes</div>
                    <div id="save-help" class="sr-only">Validate and save room configuration</div>
                </div>
            </form>
        </div>
    </div>

    <!-- Variable Management Modal -->
    <div id="variable-modal" class="modal">
        <div class="modal-content variable-modal-content">
            <div class="modal-header">
                <h2>‚ö° Manage Room Variables & Automation</h2>
                <button class="close-btn" id="close-variable-modal">√ó</button>
            </div>

            <div class="variable-modal-body">
                <!-- Variable Management Tabs -->
                <div class="variable-tabs">
                    <button class="variable-tab active" data-tab="variables">Variables</button>
                    <button class="variable-tab" data-tab="triggers">Triggers & Actions</button>
                    <button class="variable-tab" data-tab="api-docs">API Documentation</button>
                </div>

                <!-- Variables Tab -->
                <div id="variables-tab" class="variable-tab-content active">
                    <div class="variable-list-header">
                        <button class="btn-add-variable btn-primary" id="add-variable-btn">
                            ‚ûï Add Variable
                        </button>
                        <div class="variable-info">
                            <p><strong>Timer variables are created automatically:</strong> <code>timer_main</code>, <code>timer_secondary</code>, <code>timer_main_remaining</code>, <code>timer_secondary_remaining</code></p>
                        </div>
                    </div>

                    <div class="variables-list" id="variables-list">
                        <!-- Variables will be rendered here -->
                    </div>
                </div>

                <!-- Triggers & Actions Tab -->
                <div id="triggers-tab" class="variable-tab-content">
                    <div class="triggers-header">
                        <button class="btn-add-trigger btn-primary" id="add-trigger-btn">
                            ‚ûï Add Trigger
                        </button>
                    </div>

                    <div class="triggers-list" id="triggers-list">
                        <!-- Triggers will be rendered here -->
                    </div>
                </div>

                <!-- API Documentation Tab -->
                <div id="api-docs-tab" class="variable-tab-content">
                    <div class="api-docs-section">
                        <h3>API Endpoints</h3>
                        <div class="api-endpoints" id="api-endpoints">
                            <!-- API documentation will be rendered here -->
                        </div>
                    </div>
                </div>

                <div class="variable-actions">
                    <button type="button" class="btn-secondary" id="cancel-variable-btn">Cancel</button>
                    <button type="button" class="btn-primary" id="save-variables-btn">Save All Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Variable Edit/Create Form Modal -->
    <div id="variable-form-modal" class="modal">
        <div class="modal-content variable-form-content">
            <div class="modal-header">
                <h2 id="variable-form-title">Add Variable</h2>
                <button class="close-btn" id="close-variable-form-modal">√ó</button>
            </div>

            <form id="variable-form">
                <div class="form-group">
                    <label for="variable-name">Variable Name</label>
                    <input type="text" id="variable-name" name="variableName" class="form-input" placeholder="e.g., player_count" required>
                </div>

                <div class="form-group">
                    <label for="variable-type">Type</label>
                    <select id="variable-type" name="variableType" class="form-input">
                        <option value="string">String</option>
                        <option value="number">Number</option>
                        <option value="boolean">Boolean</option>
                        <option value="array">Array (JSON)</option>
                        <option value="object">Object (JSON)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="variable-value">Value</label>
                    <textarea id="variable-value" name="variableValue" class="form-input" rows="3" placeholder="For boolean: true or false; for string: any text; for number: 123; for array: [1,2,3]; for object: {&quot;key&quot;:&quot;value&quot;}"></textarea>
                </div>

                <div class="variable-form-actions">
                    <button type="button" class="btn-secondary" id="cancel-variable-form-btn">Cancel</button>
                    <button type="submit" class="btn-primary" id="save-variable-form-btn">Add Variable</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Trigger Creation Modal -->
    <div id="trigger-form-modal" class="modal">
        <div class="modal-content trigger-form-content">
            <div class="modal-header">
                <h2 id="trigger-form-title">Create Trigger</h2>
                <button class="close-btn" id="close-trigger-form-modal">√ó</button>
            </div>

            <form id="trigger-form">
                <div class="form-group">
                    <label for="trigger-name">Trigger Name</label>
                    <input type="text" id="trigger-name" class="form-input" placeholder="e.g., Door Opens" required>
                </div>

                <div class="form-group">
                    <label for="trigger-variable">Variable to Watch</label>
                    <select id="trigger-variable" class="form-input" required>
                        <option value="">Select a variable...</option>
                        <!-- Variables will be populated dynamically -->
                    </select>
                </div>

                <div class="form-group">
                    <label for="trigger-condition">Condition</label>
                    <select id="trigger-condition" class="form-input" required>
                        <option value="equals">Equals</option>
                        <option value="not_equals">Not Equals</option>
                        <option value="greater_than">Greater Than</option>
                        <option value="less_than">Less Than</option>
                        <option value="contains">Contains</option>
                        <option value="changes_to">Changes To</option>
                        <option value="changes_from">Changes From</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="trigger-value">Value</label>
                    <input type="text" id="trigger-value" class="form-input" placeholder="e.g., true, 5, unlocked" required>
                </div>

                <div class="form-group">
                    <label>Actions to Execute:</label>
                    <div class="trigger-actions-container" id="trigger-actions-container">
                        <!-- Action items will be added here -->
                    </div>
                    <button type="button" class="btn-secondary btn-add-action-to-trigger" id="add-action-to-trigger">
                        ‚ûï Add Action
                    </button>
                </div>

                <div class="trigger-form-actions">
                    <button type="button" class="btn-secondary" id="cancel-trigger-form-btn">Cancel</button>
                    <button type="submit" class="btn-primary" id="save-trigger-form-btn">Create Trigger</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Action Selection Modal -->
    <div id="action-selection-modal" class="modal">
        <div class="modal-content action-selection-content">
            <div class="modal-header">
                <h2>Select Action Type</h2>
                <button class="close-btn" id="close-action-selection-modal">√ó</button>
            </div>

            <div class="action-types-grid">
                <div class="action-type-card" data-action="play_sound">
                    <div class="action-icon">üîä</div>
                    <h3>Play Sound</h3>
                    <p>Play a notification sound through the audio system</p>
                </div>
                
                <div class="action-type-card" data-action="show_media">
                    <div class="action-icon">üñºÔ∏è</div>
                    <h3>Show Media</h3>
                    <p>Display image/video on player screen</p>
                </div>
                
                <div class="action-type-card" data-action="set_variable">
                    <div class="action-icon">üìä</div>
                    <h3>Set Variable</h3>
                    <p>Change the value of another variable</p>
                </div>
                
                <div class="action-type-card" data-action="timer_control">
                    <div class="action-icon">‚è±Ô∏è</div>
                    <h3>Timer Control</h3>
                    <p>Start, stop, or adjust the room timer</p>
                </div>
                
                <div class="action-type-card" data-action="send_webhook">
                    <div class="action-icon">üîó</div>
                    <h3>Send Webhook</h3>
                    <p>Send HTTP request to external endpoint</p>
                </div>
                
                <div class="action-type-card" data-action="show_message">
                    <div class="action-icon">üí¨</div>
                    <h3>Show Message</h3>
                    <p>Display message on player interface</p>
                </div>
                
                <div class="action-type-card" data-action="change_theme">
                    <div class="action-icon">üé®</div>
                    <h3>Change Theme</h3>
                    <p>Switch the room theme</p>
                </div>
                
                <div class="action-type-card" data-action="trigger_layout">
                    <div class="action-icon">üìê</div>
                    <h3>Change Layout</h3>
                    <p>Switch to different layout configuration</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Configuration Modal -->
    <div id="action-config-modal" class="modal">
        <div class="modal-content action-config-content">
            <div class="modal-header">
                <h2 id="action-config-title">Configure Action</h2>
                <button class="close-btn" id="close-action-config-modal">√ó</button>
            </div>

            <form id="action-config-form">
                <div id="action-config-fields">
                    <!-- Action-specific fields will be rendered here -->
                </div>

                <div class="action-config-actions">
                    <button type="button" class="btn-secondary" id="cancel-action-config-btn">Cancel</button>
                    <button type="submit" class="btn-primary" id="save-action-config-btn">Add Action</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Action Management Modal -->
    <div id="action-modal" class="modal">
        <div class="modal-content action-modal-content">
            <div class="modal-header">
                <h2>‚ö° Manage Actions</h2>
                <button class="close-btn" id="close-action-modal">√ó</button>
            </div>

            <div class="action-modal-body">
                <div class="action-list-header">
                    <button class="btn-add-action btn-primary" id="add-action-btn">
                        ‚ûï Add Action
                    </button>
                </div>

                <div class="actions-list" id="actions-list">
                    <!-- Actions will be rendered here -->
                </div>

                <div class="action-actions">
                    <button type="button" class="btn-secondary" id="cancel-action-btn">Cancel</button>
                    <button type="button" class="btn-primary" id="save-actions-btn">Save Actions</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Edit/Create Form Modal -->
    <div id="action-form-modal" class="modal">
        <div class="modal-content action-form-content">
            <div class="modal-header">
                <h2 id="action-form-title">Add Action</h2>
                <button class="close-btn" id="close-action-form-modal">√ó</button>
            </div>

            <form id="action-form">
                <div class="form-group">
                    <label for="action-name">Action Name</label>
                    <input type="text" id="action-name" class="form-input" placeholder="e.g., Welcome Message" required>
                </div>

                <div class="form-group">
                    <label for="action-type">Action Type</label>
                    <select id="action-type" class="form-input">
                        <option value="message">Display Message</option>
                        <option value="state_change">Change Game State</option>
                        <option value="timer">Set Timer</option>
                        <option value="notification">Send Notification</option>
                        <option value="sound">Play Sound</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="action-description">Description</label>
                    <textarea id="action-description" class="form-input" rows="2" placeholder="Brief description of what this action does"></textarea>
                </div>

                <div class="form-group" id="action-enabled-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="action-enabled" checked>
                        <span>Enabled</span>
                    </label>
                </div>

                <div class="action-form-actions">
                    <button type="button" class="btn-secondary" id="cancel-action-form-btn">Cancel</button>
                    <button type="submit" class="btn-primary" id="save-action-form-btn">Add Action</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Owner Customization Panel Modal -->
    <div id="owner-customization-modal" class="modal">
        <div class="modal-content owner-customization-modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è Owner Customization Panel</h2>
                <button class="close-btn" id="close-owner-customization-modal">√ó</button>
            </div>

            <div class="owner-customization-body">
                <!-- Settings Navigation Tabs -->
                <div class="settings-tabs">
                    <button class="settings-tab active" data-tab="system">System</button>
                    <button class="settings-tab" data-tab="defaults">Defaults</button>
                    <button class="settings-tab" data-tab="theme">Theme</button>
                    <button class="settings-tab" data-tab="security">Security</button>
                    <button class="settings-tab" data-tab="notifications">Notifications</button>
                </div>

                <!-- Settings Content -->
                <div class="settings-content">
                    <!-- System Settings -->
                    <div id="system-tab" class="settings-section active">
                        <h3>System Configuration</h3>
                        <div class="setting-group">
                            <label for="app-name">Application Name</label>
                            <input type="text" id="app-name" class="form-input" placeholder="Quandary">
                        </div>
                        <div class="setting-group">
                            <label for="max-rooms">Maximum Rooms Per User</label>
                            <input type="number" id="max-rooms" class="form-input" min="1" max="100" value="10">
                        </div>
                        <div class="setting-group">
                            <label for="enable-analytics">Enable Analytics</label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="enable-analytics" checked>
                                <span>Allow anonymous usage analytics</span>
                            </label>
                        </div>
                    </div>

                    <!-- Default Settings -->
                    <div id="defaults-tab" class="settings-section">
                        <h3>Default Room Settings</h3>
                        <div class="setting-group">
                            <label for="default-timer">Default Timer Duration (MM:SS)</label>
                            <input type="text" id="default-timer" class="form-input" placeholder="05:00" pattern="[0-9]{1,2}:[0-9]{2}" value="05:00">
                        </div>
                        <div class="setting-group">
                            <label for="default-room-config">Default Room Configuration</label>
                            <textarea id="default-room-config" class="form-input" rows="6" placeholder='{"theme": "default"}'></textarea>
                        </div>
                        <div class="setting-group">
                            <label for="auto-start-timer">Auto-start Room Timer</label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="auto-start-timer" checked>
                                <span>Automatically start timer when room is created</span>
                            </label>
                        </div>
                    </div>

                    <!-- Theme Settings -->
                    <div id="theme-tab" class="settings-section">
                        <h3>Theme Configuration</h3>
                        <div class="setting-group">
                            <label for="primary-color">Primary Color</label>
                            <input type="color" id="primary-color" class="form-input" value="#667eea">
                        </div>
                        <div class="setting-group">
                            <label for="secondary-color">Secondary Color</label>
                            <input type="color" id="secondary-color" class="form-input" value="#764ba2">
                        </div>
                        <div class="setting-group">
                            <label for="accent-color">Accent Color</label>
                            <input type="color" id="accent-color" class="form-input" value="#ff6b6b">
                        </div>
                        <div class="setting-group">
                            <label for="dark-mode">Dark Mode</label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="dark-mode">
                                <span>Enable dark mode by default</span>
                            </label>
                        </div>
                        <div class="setting-group">
                            <label for="font-family">Font Family</label>
                            <select id="font-family" class="form-input">
                                <option value="Arial, sans-serif">Arial</option>
                                <option value="'Segoe UI', Tahoma, Geneva, Verdana, sans-serif">Segoe UI</option>
                                <option value="'Roboto', sans-serif">Roboto</option>
                                <option value="'Montserrat', sans-serif">Montserrat</option>
                                <option value="'Inter', sans-serif">Inter</option>
                            </select>
                        </div>
                    </div>

                    <!-- Security Settings -->
                    <div id="security-tab" class="settings-section">
                        <h3>Security Configuration</h3>
                        <div class="setting-group">
                            <label for="session-timeout">Session Timeout (minutes)</label>
                            <input type="number" id="session-timeout" class="form-input" min="5" max="480" value="60">
                        </div>
                        <div class="setting-group">
                            <label for="require-password">Require Password for Rooms</label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="require-password">
                                <span>Mandate password protection for private rooms</span>
                            </label>
                        </div>
                        <div class="setting-group">
                            <label for="enable-2fa">Enable Two-Factor Authentication</label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="enable-2fa">
                                <span>Require 2FA for admin access</span>
                            </label>
                        </div>
                        <div class="setting-group">
                            <label for="api-rate-limit">API Rate Limit (requests/minute)</label>
                            <input type="number" id="api-rate-limit" class="form-input" min="10" max="1000" value="100">
                        </div>
                    </div>

                    <!-- Notification Settings -->
                    <div id="notifications-tab" class="settings-section">
                        <h3>Notification Preferences</h3>
                        <div class="setting-group">
                            <label for="email-notifications">Email Notifications</label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="email-notifications" checked>
                                <span>Send email notifications for room activities</span>
                            </label>
                        </div>
                        <div class="setting-group">
                            <label for="room-creation-alerts">Room Creation Alerts</label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="room-creation-alerts" checked>
                                <span>Notify when rooms are created</span>
                            </label>
                        </div>
                        <div class="setting-group">
                            <label for="error-alerts">System Error Alerts</label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="error-alerts" checked>
                                <span>Notify on system errors</span>
                            </label>
                        </div>
                        <div class="setting-group">
                            <label for="daily-reports">Daily Reports</label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="daily-reports">
                                <span>Send daily usage reports</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Modal Actions -->
                <div class="owner-customization-actions">
                    <button type="button" class="btn-secondary" id="reset-defaults-btn">Reset to Defaults</button>
                    <button type="button" class="btn-secondary" id="cancel-owner-customization-btn">Cancel</button>
                    <button type="button" class="btn-primary" id="save-owner-settings-btn">Save Settings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Theme Configurator Modal -->
    <div id="theme-configurator-modal" class="modal">
        <div class="modal-content theme-configurator-modal-content">
            <div class="modal-header">
                <h2>üé≠ Theme Configurator</h2>
                <button class="close-btn" id="close-theme-configurator-modal">&times;</button>
            </div>

            <div class="theme-configurator-body">
                <div class="theme-selector-section">
                    <div class="form-group">
                        <label for="theme-selector">Select Theme to Edit</label>
                        <select id="theme-selector" class="form-input">
                            <option value="">-- Select a Theme --</option>
                            <!-- Themes will be loaded dynamically -->
                        </select>
                    </div>
                </div>

                <div class="theme-editor-section" id="theme-editor-section" style="display: none;">
                    <div class="theme-editor-tabs">
                        <button class="theme-editor-tab active" data-tab="basic">Basic Info</button>
                        <button class="theme-editor-tab" data-tab="components">Components</button>
                        <button class="theme-editor-tab" data-tab="json">JSON Editor</button>
                    </div>

                    <div class="theme-editor-content">
                        <!-- Basic Info Tab -->
                        <div id="basic-tab" class="theme-editor-tab-content active">
                            <div class="form-group">
                                <label for="theme-name-edit">Theme Name</label>
                                <input type="text" id="theme-name-edit" class="form-input" placeholder="Theme Name">
                            </div>
                            <div class="form-group">
                                <label for="theme-version-edit">Version</label>
                                <input type="text" id="theme-version-edit" class="form-input" placeholder="1.0.0">
                            </div>
                            <div class="form-group">
                                <label for="theme-description-edit">Description</label>
                                <textarea id="theme-description-edit" class="form-input" rows="3" placeholder="Theme description..."></textarea>
                            </div>
                            <div class="form-group">
                                <label for="theme-author-edit">Author</label>
                                <input type="text" id="theme-author-edit" class="form-input" placeholder="Author name">
                            </div>
                        </div>

                        <!-- Components Tab -->
                        <div id="components-tab" class="theme-editor-tab-content">
                            <div class="components-config">
                                <h4>Component Configuration</h4>
                                <div id="components-list">
                                    <!-- Component controls will be generated here -->
                                </div>
                            </div>
                        </div>

                        <!-- JSON Editor Tab -->
                        <div id="json-tab" class="theme-editor-tab-content">
                            <div class="form-group">
                                <label for="theme-json-editor">Theme Configuration (JSON)</label>
                                <textarea id="theme-json-editor" class="form-input json-editor" rows="20" placeholder="{}"></textarea>
                            </div>
                            <div class="json-validation" id="json-validation">
                                <!-- Validation messages will appear here -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="theme-configurator-actions">
                    <button type="button" class="btn-secondary" id="cancel-theme-config-btn">Cancel</button>
                    <button type="button" class="btn-secondary" id="save-as-theme-btn" disabled>Save As New Theme</button>
                    <button type="button" class="btn-primary" id="save-theme-config-btn" disabled>Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Theme Details Modal -->
    <div id="theme-details-modal" class="modal">
        <div class="modal-content theme-details-modal-content">
            <div class="modal-header">
                <h2 id="theme-details-title">Theme Details</h2>
                <button class="close-btn" id="close-theme-details-modal">&times;</button>
            </div>

            <div class="theme-details-body">
                <div class="theme-preview-section">
                    <h3>Preview</h3>
                    <div class="theme-preview-container" id="theme-preview-container">
                        <!-- Theme preview will be loaded here -->
                    </div>
                </div>

                <div class="theme-info-section">
                    <h3>Information</h3>
                    <div class="theme-info-grid">
                        <div class="info-item">
                            <label>Name:</label>
                            <span id="theme-info-name">-</span>
                        </div>
                        <div class="info-item">
                            <label>Description:</label>
                            <span id="theme-info-description">-</span>
                        </div>
                        <div class="info-item">
                            <label>Version:</label>
                            <span id="theme-info-version">-</span>
                        </div>
                        <div class="info-item">
                            <label>Author:</label>
                            <span id="theme-info-author">-</span>
                        </div>
                        <div class="info-item">
                            <label>Type:</label>
                            <span id="theme-info-type">-</span>
                        </div>
                        <div class="info-item" id="parent-theme-info" style="display: none;">
                            <label>Parent Theme:</label>
                            <span id="theme-info-parent">-</span>
                        </div>
                        <div class="info-item">
                            <label>Created:</label>
                            <span id="theme-info-created">-</span>
                        </div>
                        <div class="info-item">
                            <label>Last Updated:</label>
                            <span id="theme-info-updated">-</span>
                        </div>
                    </div>
                </div>

                <div class="theme-assets-section">
                    <h3>Assets</h3>
                    <div class="theme-assets-list" id="theme-assets-list">
                        <!-- Theme assets will be listed here -->
                    </div>
                    <div class="theme-assets-actions">
                        <button class="btn-secondary" id="add-asset-btn">‚ûï Add Asset</button>
                    </div>
                </div>

                <div class="theme-actions-section">
                    <h3>Actions</h3>
                    <div class="theme-actions">
                        <button class="btn-primary" id="apply-theme-btn">Apply to Room</button>
                        <button class="btn-secondary" id="edit-theme-btn">Edit Theme</button>
                        <button class="btn-secondary" id="duplicate-theme-btn">Duplicate</button>
                        <button class="btn-danger" id="delete-theme-btn">Delete</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Layout Management Modal -->
    <div id="layout-modal" class="modal">
        <div class="modal-content layout-modal-content">
            <div class="modal-header">
                <h2>üé® Layout Configuration Manager</h2>
                <button class="close-btn" id="close-layout-modal">&times;</button>
            </div>

            <div class="layout-modal-body">
                <div class="layout-tabs">
                    <button class="layout-tab active" data-layout="default">Default</button>
                    <button class="layout-tab" data-layout="mobile">Mobile</button>
                    <button class="layout-tab" data-layout="compact">Compact</button>
                    <button class="layout-tab" data-layout="custom">Custom</button>
                </div>

                <div class="layout-content">
                    <div id="default-layout" class="layout-section active">
                        <h3>Default Grid Layout</h3>
                        <div class="layout-preview" id="default-preview">
                            <!-- Preview will be generated here -->
                        </div>
                        <div class="layout-config">
                            <h4>Configuration</h4>
                            <div class="config-group">
                                <label>Grid Template:
                                    <select id="default-grid-template" class="form-input">
                                        <option value="1fr 2fr">Sidebar + Main</option>
                                        <option value="1fr 1fr 1fr">Three Column</option>
                                        <option value="2fr 1fr">Main + Sidebar</option>
                                    </select>
                                </label>
                            </div>
                            <div class="config-group">
                                <label>Gap Size:
                                    <input type="range" id="default-gap-size" min="0" max="20" value="10" class="form-input">
                                    <span id="default-gap-value">10px</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div id="mobile-layout" class="layout-section">
                        <h3>Mobile Optimized Layout</h3>
                        <div class="layout-preview" id="mobile-preview">
                            <!-- Preview will be generated here -->
                        </div>
                        <div class="layout-config">
                            <h4>Configuration</h4>
                            <div class="config-group">
                                <label>Stack Direction:
                                    <select id="mobile-stack-direction" class="form-input">
                                        <option value="column">Vertical</option>
                                        <option value="column-reverse">Vertical Reverse</option>
                                    </select>
                                </label>
                            </div>
                            <div class="config-group">
                                <label>Responsive Breakpoint:
                                    <select id="mobile-breakpoint" class="form-input">
                                        <option value="768px">Tablet (768px)</option>
                                        <option value="640px">Mobile (640px)</option>
                                        <option value="480px">Small Mobile (480px)</option>
                                    </select>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div id="compact-layout" class="layout-section">
                        <h3>Compact Layout</h3>
                        <div class="layout-preview" id="compact-preview">
                            <!-- Preview will be generated here -->
                        </div>
                        <div class="layout-config">
                            <h4>Configuration</h4>
                            <div class="config-group">
                                <label>Component Spacing:
                                    <input type="range" id="compact-spacing" min="4" max="16" value="8" class="form-input">
                                    <span id="compact-spacing-value">8px</span>
                                </label>
                            </div>
                            <div class="config-group">
                                <label>Hide Non-essential:
                                    <input type="checkbox" id="compact-hide-nonessential" checked>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div id="custom-layout" class="layout-section">
                        <h3>Custom Layout</h3>
                        <div class="layout-preview" id="custom-preview">
                            <!-- Preview will be generated here -->
                        </div>
                        <div class="layout-config">
                            <h4>JSON Configuration</h4>
                            <div class="config-group">
                                <label>Layout JSON:
                                    <textarea id="custom-layout-json" class="form-input" rows="10" placeholder='{"layouts": {...}}'></textarea>
                                </label>
                            </div>
                            <div class="config-group">
                                <button id="validate-layout-btn" class="btn-secondary">Validate Layout</button>
                                <button id="load-preset-btn" class="btn-secondary">Load Preset</button>
                            </div>
                            <div id="layout-validation-results" class="validation-results">
                                <!-- Validation results will appear here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="layout-actions">
                <button type="button" class="btn-secondary" id="cancel-layout-btn">Cancel</button>
                <button type="button" class="btn-primary" id="save-layout-btn">Save Layout</button>
            </div>
        </div>
    </div>


    <script src="/socket.io/socket.io.js"></script>
    <script src="/ui-state.js"></script>
    <script src="/theme-configurator.js"></script>
    <script src="/variable-manager.js"></script>
    <script src="/admin.js"></script>
    <script src="/admin-layout-controls.js"></script>
</body>
</html>